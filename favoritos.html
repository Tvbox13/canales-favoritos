<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ“º Reproductor TV Completo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/clappr@0.4.7/dist/clappr.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #121212;
      font-family: Arial, sans-serif;
      color: white;
    }

    h1 {
      text-align: center;
      color: #00ffff;
      margin-top: 20px;
    }

    #contenedor-canales {
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .canal-btn {
      background-color: #1e88e5;
      border: none;
      border-radius: 10px;
      padding: 15px;
      color: white;
      font-size: 18px;
      cursor: pointer;
      width: 200px;
      transition: 0.2s;
    }

    .canal-btn:hover, .canal-btn:focus {
      background-color: #1565c0;
      outline: 2px solid yellow;
    }

    #player {
      width: 100vw;
      height: 100vh;
      display: none;
      background: black;
    }
  </style>
</head>
<body>
  <h1>ðŸ“º Canales Favoritos</h1>
  <div id="contenedor-canales"></div>
  <div id="player"></div>

  <script>
    const m3uUrl = 'https://raw.githubusercontent.com/Tvbox13/canales-favoritos/main/lista.m3u';
    const contenedor = document.getElementById('contenedor-canales');
    const playerDiv = document.getElementById('player');
    let playerInstance = null;

    function reproducirStream(url) {
      contenedor.style.display = 'none';
      playerDiv.style.display = 'block';
      if (playerInstance) {
        playerInstance.destroy();
      }
      playerInstance = new Clappr.Player({
        source: url,
        parentId: '#player',
        autoPlay: true,
        mute: false,
        height: '100%',
        width: '100%',
        playback: {
          hlsUseNextLevel: true,
        }
      });

      document.addEventListener("keydown", (e) => {
        if (["Backspace", "Escape"].includes(e.key)) {
          playerInstance.stop();
          playerDiv.style.display = 'none';
          contenedor.style.display = 'flex';
          const primerBoton = document.querySelector('.canal-btn');
          if (primerBoton) primerBoton.focus();
        }
      });
    }

    fetch(m3uUrl)
      .then(res => res.text())
      .then(text => {
        const lines = text.split('\n');
        let canales = [];

        for (let i = 0; i < lines.length; i++) {
          if (lines[i].startsWith('#EXTINF')) {
            const nombre = lines[i].split(',')[1]?.trim();
            const logoMatch = lines[i].match(/tvg-logo="(.*?)"/);
            const logo = logoMatch ? logoMatch[1] : '';
            const url = lines[i + 1]?.trim();
            if (url && url.startsWith('http')) {
              canales.push({ nombre, url, logo });
            }
          }
        }

        canales.forEach(canal => {
          const btn = document.createElement('button');
          btn.className = 'canal-btn';
          btn.innerHTML = canal.logo
            ? `<img src="${canal.logo}" alt="" style="height:30px;vertical-align:middle;margin-right:10px;"> ${canal.nombre}`
            : `â–¶ ${canal.nombre}`;
          btn.onclick = () => reproducirStream(canal.url);
          contenedor.appendChild(btn);
        });
      });
  </script>
</body>
</html>
