<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ“º Reproductor TV Completo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/clappr@0.4.7/dist/clappr.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #121212;
      font-family: Arial, sans-serif;
      color: white;
    }

    h1 {
      text-align: center;
      color: #00ffff;
      margin-top: 20px;
    }

    #contenedor-canales {
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .canal-btn {
      background-color: #1e88e5;
      border: none;
      border-radius: 10px;
      padding: 15px;
      color: white;
      font-size: 18px;
      cursor: pointer;
      width: 90%;
      max-width: 300px;
      transition: 0.2s;
      text-align: left;
    }

    .canal-btn:hover, .canal-btn:focus {
      background-color: #1565c0;
      outline: 2px solid yellow;
    }

    #player-container {
      width: 100vw;
      height: 100vh;
      display: none;
      background-color: black;
    }
  </style>
</head>
<body>
  <h1>ðŸ“º Canales Favoritos</h1>
  <div id="contenedor-canales"></div>
  <div id="player-container"></div>

  <script>
    const m3uUrl = 'https://raw.githubusercontent.com/Tvbox13/canales-favoritos/main/lista.m3u';
    const contenedor = document.getElementById('contenedor-canales');
    const playerContainer = document.getElementById('player-container');
    let player = null;

    function reproducir(url) {
      contenedor.style.display = 'none';
      playerContainer.style.display = 'block';

      if (player) {
        player.destroy();
      }

      player = new Clappr.Player({
        source: url,
        parentId: '#player-container',
        autoPlay: true,
        mute: false,
        height: '100%',
        width: '100%',
      });

      document.addEventListener('keydown', function (e) {
        if (['Backspace', 'Escape'].includes(e.key)) {
          player.destroy();
          playerContainer.style.display = 'none';
          contenedor.style.display = 'flex';
          const primero = document.querySelector('.canal-btn');
          if (primero) primero.focus();
        }
      });
    }

    function cargarCanales() {
      fetch(m3uUrl)
        .then(res => res.text())
        .then(data => {
          const lines = data.split('\n');
          let nombre = '', url = '', logo = '';

          for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith('#EXTINF')) {
              const matchNombre = lines[i].split(',')[1]?.trim();
              const matchLogo = lines[i].match(/tvg-logo="(.*?)"/);
              nombre = matchNombre;
              logo = matchLogo ? matchLogo[1] : '';
            } else if (lines[i].startsWith('http')) {
              url = lines[i].trim();
              if (url && nombre) {
                const btn = document.createElement('button');
                btn.className = 'canal-btn';
                btn.innerHTML = logo
                  ? `<img src="${logo}" style="height:24px; vertical-align:middle; margin-right:10px;"> ${nombre}`
                  : `â–¶ ${nombre}`;
                btn.onclick = () => reproducir(url);
                contenedor.appendChild(btn);
              }
            }
          }
        })
        .catch(err => console.error('Error al cargar la lista:', err));
    }

    cargarCanales();
  </script>
</body>
</html>
