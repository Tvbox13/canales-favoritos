<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DC TV - Categor√≠as</title>
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>

  <style>
    :root {
      --text-color: #fff;
      --focus-outline: 3px solid gold;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('https://dl.dropboxusercontent.com/scl/fi/53cl5dg07jneprsqbvkdp/Fondo-dorado-negro.jpg?rlkey=fxysssw9toe3zdhw873nob0k7&st=brpgsbw8&dl=0') no-repeat center center fixed;
      background-size: cover;
      color: var(--text-color);
      text-align: center;
      position: relative;
      z-index: 1;
      overflow-y: auto;
      outline: none;
      user-select: none;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 0;
    }

    .container {
      width: 90%;
      max-width: 1200px;
      margin: auto;
      padding: 20px 0 60px 0;
      position: relative;
      z-index: 1;
      outline: none;
    }

    h1 {
      font-size: 4rem;
      margin: 40px 0 30px;
      background: linear-gradient(to right, gold, white, black);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.8), 0 0 20px gold;
    }

    h2 {
      font-size: 2.5rem;
      margin-top: 30px;
      cursor: pointer;
      color: gold;
      text-shadow: 1px 1px 4px black;
      border-bottom: 2px solid gold;
      padding-bottom: 10px;
      outline-offset: 4px;
    }

    h2:focus {
      outline: var(--focus-outline);
      border-color: white;
    }

    #buscador {
      padding: 16px;
      font-size: 24px;
      width: 90%;
      max-width: 600px;
      margin: 20px auto 30px auto;
      border-radius: 12px;
      border: none;
      outline: none;
      background-color: rgba(255, 255, 255, 0.15);
      color: white;
      text-align: center;
      box-shadow: 0 0 15px gold;
    }

    #buscador:focus {
      outline: var(--focus-outline);
      box-shadow: 0 0 25px white;
    }

    .canales-container {
      display: none;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
      max-height: 500px;
      overflow-y: auto;
      outline: none;
    }

    .canal {
      width: 100%;
      height: 25px;
      margin: 10px 0;
      padding: 10px;
      display: flex;
      flex-direction: row;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      border: 3px solid gold;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      font-size: 1.6rem;
      font-weight: bold;
      color: gold;
      text-shadow: 2px 2px 4px black;
      outline-offset: 6px;
    }

    .canal:hover,
    .canal:focus {
      transform: scale(1.05);
      box-shadow: 0 0 30px gold;
      outline: var(--focus-outline);
    }

    .canal img {
      width: 30px;
      height: 22.5px;
      object-fit: contain;
      background-color: black;
      border-radius: 12px;
      margin-right: 6px;
    }

    .canal span {
      flex: 1;
      text-align: left;
    }

    #player-wrapper {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      z-index: 9999;
    }

    #player {
      width: 100%;
      height: 100%;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 3rem;
      }
      h2 {
        font-size: 1.8rem;
      }
      #buscador {
        font-size: 18px;
      }
      .canal {
        height: auto;
        font-size: 1.2rem;
      }
      .canal img {
        width: 80px;
        height: 60px;
        margin-right: 15px;
      }
    }
  </style>
</head>
<body tabindex="0">
  <div class="container" tabindex="-1">
    <h1>DC TV</h1>
    <input type="text" id="buscador" placeholder="üîç Buscar canal..." autocomplete="off" />
    <div id="categorias"></div>
  </div>

  <div id="player-wrapper" tabindex="-1" role="dialog" aria-modal="true" aria-label="Reproductor de video">
    <div id="player"></div>
  </div>

  <script>
    const OWNER = "Tvbox13";
    const REPO = "canales-favoritos";

    const archivosM3U = [
      { nombre: "Categor√≠a 1", archivo: "lista.m3u" },
      { nombre: "Categor√≠a 2", archivo: "lista 2.m3u" },
      { nombre: "Categor√≠a 3", archivo: "lista3.m3u" },
      { nombre: "Categor√≠a 4", archivo: "lista 2.m3u" }
    ];

    const categoriasContainer = document.getElementById("categorias");
    const buscador = document.getElementById("buscador");
    const playerWrapper = document.getElementById("player-wrapper");
    const playerElement = document.getElementById("player");
    let playerInstance = null;

    // No m√°s intent:// ni enlaces para Android TV, usar siempre Clappr para reproducir
    // Para enfocar mejor el primer canal cargado o el t√≠tulo al abrir categor√≠a
    function focusFirstCanal(container) {
      const primerCanal = container.querySelector(".canal");
      if (primerCanal) primerCanal.focus();
    }

    // Construir categor√≠as y eventos
    archivosM3U.forEach((item, index) => {
      const url = `https://raw.githubusercontent.com/${OWNER}/${REPO}/main/${encodeURIComponent(item.archivo)}`;

      const categoriaDiv = document.createElement("div");
      categoriaDiv.className = "categoria";

      const titulo = document.createElement("h2");
      titulo.textContent = item.nombre;
      titulo.tabIndex = 0;
      titulo.setAttribute("role", "button");
      titulo.setAttribute("aria-expanded", "false");
      titulo.setAttribute("aria-controls", `categoria-${index}`);

      titulo.addEventListener("click", () => toggleCategoria(index, url));
      titulo.addEventListener("keydown", e => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleCategoria(index, url);
        }
      });

      const canalesDiv = document.createElement("div");
      canalesDiv.className = "canales-container";
      canalesDiv.id = `categoria-${index}`;
      canalesDiv.setAttribute("role", "region");
      canalesDiv.setAttribute("aria-label", `Lista de canales de ${item.nombre}`);
      canalesDiv.tabIndex = -1;

      categoriaDiv.appendChild(titulo);
      categoriaDiv.appendChild(canalesDiv);
      categoriasContainer.appendChild(categoriaDiv);
    });

    function toggleCategoria(index, url) {
      const div = document.getElementById(`categoria-${index}`);
      const titulo = div.previousElementSibling;
      const isVisible = div.style.display === "flex";

      // Cerrar todas las categor√≠as
      document.querySelectorAll(".canales-container").forEach(d => {
        d.style.display = "none";
        d.previousElementSibling.setAttribute("aria-expanded", "false");
      });

      if (!isVisible) {
        div.innerHTML = "";
        div.style.display = "flex";
        div.focus();
        titulo.setAttribute("aria-expanded", "true");
        cargarListaM3U(url, div).then(() => focusFirstCanal(div));
      }
    }

    async function cargarListaM3U(m3uUrl, container) {
      try {
        const r = await fetch(m3uUrl);
        const data = await r.text();
        const lines = data.split("\n");
        for (let i = 0; i < lines.length; i++) {
          if (lines[i].startsWith("#EXTINF")) {
            const nombre = lines[i].split(",")[1]?.trim() || "Canal";
            const logoMatch = lines[i].match(/tvg-logo="([^"]+)"/);
            const logo = logoMatch ? logoMatch[1] : "";
            const url = lines[i + 1]?.trim();
            if (url && url.startsWith("http")) {
              agregarCanal(nombre, url, logo, container);
            }
          }
        }
      } catch(err) {
        console.error("Error cargando M3U:", err);
        container.innerHTML = "<p style='color: red;'>No se pudo cargar la lista de canales.</p>";
      }
    }

    function agregarCanal(nombre, url, logo, container) {
      const canal = document.createElement("button");
      canal.className = "canal";
      canal.setAttribute("data-nombre", nombre.toLowerCase());
      canal.tabIndex = 0;
      canal.setAttribute("aria-label", `Reproducir canal ${nombre}`);

      canal.addEventListener("click", () => reproducir(url, canal));
      canal.addEventListener("keydown", e => { if (e.key === "Enter") canal.click(); });

      if (logo) {
        const img = document.createElement("img");
        img.src = logo;
        img.alt = nombre;
        canal.appendChild(img);
      }

      const span = document.createElement("span");
      span.textContent = nombre;
      canal.appendChild(span);

      container.appendChild(canal);
    }

    function reproducir(url, canalBoton) {
  const vlcUrl = url.startsWith("http") ? url.replace(/^http(s)?:\/\//, "vlc://") : url;
  window.open(vlcUrl, '_blank');
}



    // Cerrar reproductor con ESC o bot√≥n Atr√°s
    document.addEventListener("keydown", e => {
      if ((e.key === "Escape" || e.key === "Backspace") && playerWrapper.style.display === "block") {
        playerWrapper.style.display = "none";
        if (playerInstance) { playerInstance.destroy(); playerInstance = null; }
        document.body.style.overflow = "auto";

        // Regresar foco al √∫ltimo canal seleccionado
        const ultimoFoco = document.activeElement;
        if (ultimoFoco && ultimoFoco.classList.contains("canal")) {
          ultimoFoco.focus();
        } else {
          // Si no, al buscador
          buscador.focus();
        }
      }
    });

    // Buscar canales (filtrado)
    buscador.addEventListener("input", () => {
      const filtro = buscador.value.toLowerCase();
      document.querySelectorAll(".canal").forEach(canal => {
        const nombre = canal.getAttribute("data-nombre");
        canal.style.display = nombre.includes(filtro) ? "flex" : "none";
      });

      // Si filtro est√° vac√≠o, mostrar todas las categor√≠as cerradas
      if (filtro === "") {
        document.querySelectorAll(".canales-container").forEach(div => {
          div.style.display = "none";
          div.previousElementSibling.setAttribute("aria-expanded", "false");
        });
      }
    });

    window.onload = () => {
  const primerTitulo = document.querySelector("#categorias h2");
  if (primerTitulo) primerTitulo.focus();
};
  </script>
</body>
</html>




